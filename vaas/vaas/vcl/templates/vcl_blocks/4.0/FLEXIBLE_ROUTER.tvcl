# Flexible ROUTER
{% if canary_header %}
    if (req.http.{{ validation_header }} == "1") {
        set req.http.{{ canary_header }} = 100;
    } else {
        set req.http.{{ canary_header }} = std.random(0, 100);
    }
{% endif %}
{% for route in routes %}
    {% if loop.index > 1 %}    else if {% else %}    if {% endif %}({{ route.condition }}) {
        <SET_ROUTE_{{route.id}}/>
    }
{% endfor %}

{% if canary_header %}
    unset req.http.{{ canary_header }};
{% endif %}